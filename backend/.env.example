# Backend Environment Variables
# Copy this file to .env and adjust as needed

# Server Configuration
HOST=0.0.0.0
PORT=8000
DEBUG=True

# CORS Origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# Matching Configuration
SIMILARITY_THRESHOLD=85.0

# ============================================================
# Embedding Configuration
# ============================================================

# OpenAI API Key (required for 'openai-small' or 'openai-large' modes)
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=

# Default embedding mode: 'openai-small', 'openai-large', 'local', or 'disabled'
# - openai-small: Balanced quality/cost (recommended, ~85% accuracy, $0.02/1M tokens)
# - openai-large: Best quality (~90% accuracy, $0.13/1M tokens)
# - local: Privacy mode, runs locally (~75% accuracy, no cost, uses ~150MB RAM)
# - disabled: No embeddings, fuzzy matching only (~61% accuracy)
DEFAULT_EMBEDDING_MODE=openai-small

# Local embedding model (used in 'local' mode)
LOCAL_EMBEDDING_MODEL=all-MiniLM-L6-v2

# Embedding dimensions (lower = faster, higher = more accurate)
# OpenAI default is 1536, we use 512 for speed
EMBEDDING_DIMENSIONS=512

# Similarity score weights (must sum to ~1.0)
# Controls how much each component contributes to final similarity score
WRATIO_WEIGHT=0.40          # Fuzzy string matching (handles typos)
TOKEN_SET_WEIGHT=0.15       # Token overlap (reduced from 0.40 to fix shared-word problem)
EMBEDDING_WEIGHT=0.45       # Semantic similarity (NEW - understands context)

# GMM Adaptive Threshold Configuration
USE_ADAPTIVE_THRESHOLD=False
GMM_MIN_SAMPLES=50
GMM_MAX_PAIRS=50000
GMM_FALLBACK_T_HIGH=92.0
GMM_FALLBACK_T_LOW=80.0

# ============================================================
# Stratified Sampling Configuration
# ============================================================

# Blocking Configuration
# Min block size: Blocks smaller than this are treated as singletons (no pairs)
BLOCKING_MIN_BLOCK_SIZE=2

# Max pairs per block: Cap comparisons per block to prevent giant blocks from dominating
BLOCKING_MAX_BLOCK_PAIRS=5000

# Sampling Budget Split: Within-Block vs Cross-Block
# Within-block: Sample from names in same block (potentially similar)
# Cross-block: Sample from names in different blocks (rare matches)
SAMPLING_WITHIN_BLOCK_PCT=0.95
SAMPLING_CROSS_BLOCK_PCT=0.05

# Within-Block Allocation: Proportional vs Floor
# Proportional: Larger blocks get more samples (80%)
# Floor: Even distribution ensures small blocks get represented (20%)
SAMPLING_PROPORTIONAL_PCT=0.80
SAMPLING_FLOOR_PCT=0.20

# Reproducibility: Fixed RNG seed for deterministic sampling
# Change this value to get different (but still reproducible) samples
SAMPLING_RNG_SEED=42

# Logging
LOG_LEVEL=INFO
